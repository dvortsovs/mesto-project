(()=>{"use strict";function e(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))}var t={userId:"",urls:{baseUrl:"https://nomoreparties.co/v1/plus-cohort-5",cards:"/cards",likes:"/cards/likes",userInfo:"/users/me",avatar:"/users/me/avatar"},headers:{headers:{authorization:"0ebadb24-8922-4810-85ba-1c7bc357561a","Content-Type":"application/json"}}},n={formSelector:".popup__form",inputSelector:".popup__input",fieldsetSelector:".popup__input-container",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};function o(e){if(e.ok)return e.json();Promise.reject(e.status)}function r(e,t){return fetch("".concat(e.urls.baseUrl).concat(t),e.headers).then(o)}function c(e,t,n){return fetch("".concat(e.urls.baseUrl).concat(t),{method:"PATCH",headers:e.headers.headers,body:JSON.stringify(n)}).then(o)}function u(e,t,n){return fetch("".concat(e.urls.baseUrl).concat(t,"/").concat(n),{method:"DELETE",headers:e.headers.headers}).then(o)}var a=document.querySelectorAll(".popup"),i=document.querySelector(".popup_type_edit"),l=document.querySelector(".popup_type_add"),s=document.querySelector(".popup_type_avatar"),p=l.querySelector(".popup__form"),d=p.querySelector(".popup__input_type_title"),f=p.querySelector(".popup__input_type_link"),_=i.querySelector(".popup__form"),v=s.querySelector(".popup__form").querySelector(".popup__input_type_avatar"),m=_.querySelector(".popup__input_type_name"),y=_.querySelector(".popup__input_type_caption"),S=document.querySelector(".profile__name"),h=document.querySelector(".profile__caption"),b=i.querySelector(".popup__save-button"),q=l.querySelector(".popup__save-button"),E=s.querySelector(".popup__save-button");function C(e){e.classList.add("popup_opened"),document.addEventListener("keydown",L)}function k(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",L)}function L(e){"Escape"===e.key&&k(document.querySelector(".popup_opened"))}var g=document.querySelector(".elements__list"),x=document.querySelector(".popup_type_image"),A=x.querySelector(".popup__image"),I=x.querySelector(".popup__title");function B(e,t){var n=document.querySelector("#content-card").content.querySelector(".content-card").cloneNode(!0),r=n.querySelector(".content-card__image"),c=n.querySelector(".content-card__delete-button"),a=n.querySelector(".content-card__like-button"),i=n.querySelector(".content-card__like-counter");n.querySelector(".content-card__title").textContent=e.name,i.textContent=e.likes.length,r.src=e.link,r.alt=e.name,r.addEventListener("click",(function(){A.src=e.link,A.alt=e.name,I.textContent=e.name,C(x)})),D(e,t)&&a.classList.add("content-card__like-button_active");var l=e;return a.addEventListener("click",(function(){D(l,t)?function(e,t){return u(e,e.urls.likes,t._id)}(t,e).then((function(e){l=e,i.textContent=e.likes.length,a.classList.remove("content-card__like-button_active")})).catch((function(e){console.log("Error ".concat(e))})):function(e,t){return function(e,t,n){return fetch("".concat(e.urls.baseUrl).concat(t,"/").concat(n),{method:"PUT",headers:e.headers.headers}).then(o)}(e,e.urls.likes,t._id)}(t,e).then((function(e){l=e,i.textContent=e.likes.length,a.classList.add("content-card__like-button_active")})).catch((function(e){console.log("Error ".concat(e))}))})),e.owner._id!==t.userId?c.remove():c.addEventListener("click",(function(){return function(e,t,n,o){u(e,t,n).then((function(){o.remove()})).catch((function(e){console.log("Error: ".concat(e))}))}(t,t.urls.cards,e._id,n)})),n}function U(e){g.prepend(e)}function D(e,t){return e.likes.some((function(e){return e._id===t.userId}))}var T=document.querySelector(".avatar");function w(e,t){t.style.backgroundImage="url(".concat(e,")")}function P(e,t,n){e?(t.textContent="Сохранение...",t.setAttribute("disabled",!0)):(t.textContent=n,t.removeAttribute("disabled"))}var j,N=document.querySelector(".page"),O=N.querySelector(".profile__edit-button"),J=N.querySelector(".profile__add-button"),z=N.querySelector(".avatar__edit"),H=document.forms.avatar,M=document.forms.add,F=Array.from(M.querySelectorAll(n.inputSelector)),G=M.querySelector(n.submitButtonSelector),K=Array.from(H.querySelectorAll(n.inputSelector)),Q=H.querySelector(n.submitButtonSelector);!function(e,t,n,o){r(e,t).then((function(t){e.userId=t._id,n.textContent=t.name,o.textContent=t.about,w(t.avatar,T),function(e,t){r(e,t).then((function(t){t.reverse().forEach((function(t){U(B(t,e))}))})).catch((function(e){console.log("Error: ".concat(e))}))}(e,e.urls.cards)})).catch((function(e){console.log("Error: ".concat(e))}))}(t,t.urls.userInfo,S,h),j=n,Array.from(document.querySelectorAll(j.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(j.fieldsetSelector)).forEach((function(t){!function(t,n){var o=Array.from(t.querySelectorAll(n.inputSelector)),r=t.querySelector(n.submitButtonSelector);e(o,r,n),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(t,c,n),e(o,r,n)}))}))}(t,j)}))})),a.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&k(e),t.target.classList.contains("popup__close-button")&&k(e)}))})),O.addEventListener("click",(function(){m.value=S.textContent,y.value=h.textContent,C(i)})),J.addEventListener("click",(function(){e(F,G,n),C(l)})),z.addEventListener("click",(function(){e(K,Q,n),C(s)})),_.addEventListener("submit",(function(e){return function(e,t,n){e.preventDefault();var o=b.textContent;P(!0,b,""),function(e,t,n,o,r,u,a,i){c(e,t,n).then((function(e){o.textContent=e.name,r.textContent=e.about,k(u)})).catch((function(e){console.log("Error: ".concat(e))})).finally((function(){P(!1,a,i)}))}(t,n,{name:m.value,about:y.value},S,h,i,b,o)}(e,t,t.urls.userInfo)})),p.addEventListener("submit",(function(e){return function(e,t,n){e.preventDefault();var r=q.textContent;P(!0,q,""),function(e,t,n,r,c,u){(function(e,t,n){return fetch("".concat(e.urls.baseUrl).concat(t),{method:"POST",headers:e.headers.headers,body:JSON.stringify(n)}).then(o)})(e,t,n).then((function(t){U(B(t,e)),k(r),r.querySelector(".popup__form").reset()})).catch((function(e){console.log("Error: ".concat(e))})).finally((function(){P(!1,c,u)}))}(t,n,{name:d.value,link:f.value},l,q,r)}(e,t,t.urls.cards)})),H.addEventListener("submit",(function(e){return function(e,t,n){e.preventDefault();var o=E.textContent;P(!0,E,""),function(e,t,n,o,r,u){c(e,t,n).then((function(e){w(e.avatar,T),k(o),o.querySelector(".popup__form").reset()})).catch((function(e){console.log("Error: ".concat(e))})).finally((function(){P(!1,r,u)}))}(t,n,{avatar:v.value},s,E,o)}(e,t,t.urls.avatar)}))})();