(()=>{"use strict";function e(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))}var t={userId:"",urls:{baseUrl:"https://nomoreparties.co/v1/plus-cohort-5",cards:"/cards",likes:"/cards/likes",userInfo:"/users/me",avatar:"/users/me/avatar"},headers:{headers:{authorization:"0ebadb24-8922-4810-85ba-1c7bc357561a","Content-Type":"application/json"}}},n={formSelector:".popup__form",inputSelector:".popup__input",fieldsetSelector:".popup__input-container",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};function o(e){if(e.ok)return e.json();Promise.reject(e.status)}function r(e,t){return fetch("".concat(e.urls.baseUrl).concat(t),e.headers).then(o)}function c(e,t,n){return fetch("".concat(e.urls.baseUrl).concat(t),{method:"PATCH",headers:e.headers.headers,body:JSON.stringify(n)}).then(o)}function u(e,t,n){return fetch("".concat(e.urls.baseUrl).concat(t,"/").concat(n),{method:"DELETE",headers:e.headers.headers}).then(o)}var a=document.querySelectorAll(".popup"),i=document.querySelector(".popup_type_edit"),s=document.querySelector(".popup_type_add"),l=document.querySelector(".popup_type_avatar"),p=s.querySelector(".popup__form"),d=p.querySelector(".popup__input_type_title"),_=p.querySelector(".popup__input_type_link"),f=i.querySelector(".popup__form"),v=l.querySelector(".popup__form"),m=v.querySelector(".popup__input_type_avatar"),y=f.querySelector(".popup__input_type_name"),S=f.querySelector(".popup__input_type_caption"),h=document.querySelector(".profile__name"),b=document.querySelector(".profile__caption"),q=i.querySelector(".popup__save-button"),E=s.querySelector(".popup__save-button"),C=l.querySelector(".popup__save-button");function k(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g)}function L(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g)}function g(e){"Escape"===e.key&&L(document.querySelector(".popup_opened"))}var x=document.querySelector(".elements__list"),A=document.querySelector(".popup_type_image"),I=A.querySelector(".popup__image"),U=A.querySelector(".popup__title");function B(e,t){var n=document.querySelector("#content-card").content.querySelector(".content-card").cloneNode(!0),r=n.querySelector(".content-card__image"),c=n.querySelector(".content-card__delete-button"),a=n.querySelector(".content-card__like-button"),i=n.querySelector(".content-card__like-counter");n.querySelector(".content-card__title").textContent=e.name,i.textContent=e.likes.length,r.src=e.link,r.alt=e.name,r.addEventListener("click",(function(){I.src=e.link,I.alt=e.name,U.textContent=e.name,k(A)})),T(e,t)&&a.classList.add("content-card__like-button_active");var s=e;return a.addEventListener("click",(function(){T(s,t)?function(e,t){return u(e,e.urls.likes,t._id)}(t,e).then((function(e){s=e,i.textContent=e.likes.length,a.classList.remove("content-card__like-button_active")})).catch((function(e){console.log("Error ".concat(e))})):function(e,t){return function(e,t,n){return fetch("".concat(e.urls.baseUrl).concat(t,"/").concat(n),{method:"PUT",headers:e.headers.headers}).then(o)}(e,e.urls.likes,t._id)}(t,e).then((function(e){s=e,i.textContent=e.likes.length,a.classList.add("content-card__like-button_active")})).catch((function(e){console.log("Error ".concat(e))}))})),e.owner._id!==t.userId?c.remove():c.addEventListener("click",(function(){return function(e,t,n,o){u(e,t,n).then((function(){o.remove()})).catch((function(e){console.log("Error: ".concat(e))}))}(t,t.urls.cards,e._id,n)})),n}function D(e){x.prepend(e)}function T(e,t){return e.likes.some((function(e){return e._id===t.userId}))}var w=document.querySelector(".avatar");function P(e,t){t.style.backgroundImage="url(".concat(e,")")}function j(e,t,n){e?(t.textContent="Сохранение...",t.setAttribute("disabled",!0)):(t.textContent=n,t.removeAttribute("disabled"))}var N,O=document.querySelector(".page"),J=O.querySelector(".profile__edit-button"),z=O.querySelector(".profile__add-button"),H=O.querySelector(".avatar__edit"),M=document.forms.add,F=Array.from(M.querySelectorAll(n.inputSelector)),G=M.querySelector(n.submitButtonSelector);!function(e,t,n,o){r(e,t).then((function(t){e.userId=t._id,n.textContent=t.name,o.textContent=t.about,P(t.avatar,w),function(e,t){r(e,t).then((function(t){t.reverse().forEach((function(t){D(B(t,e))}))})).catch((function(e){console.log("Error: ".concat(e))}))}(e,e.urls.cards)})).catch((function(e){console.log("Error: ".concat(e))}))}(t,t.urls.userInfo,h,b),N=n,Array.from(document.querySelectorAll(N.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(N.fieldsetSelector)).forEach((function(t){!function(t,n){var o=Array.from(t.querySelectorAll(n.inputSelector)),r=t.querySelector(n.submitButtonSelector);e(o,r,n),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(t,c,n),e(o,r,n)}))}))}(t,N)}))})),a.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&L(e),t.target.classList.contains("popup__close-button")&&L(e)}))})),J.addEventListener("click",(function(){y.value=h.textContent,S.value=b.textContent,k(i)})),z.addEventListener("click",(function(){e(F,G,n),k(s)})),H.addEventListener("click",(function(){e(F,G,n),k(l)})),f.addEventListener("submit",(function(e){return function(e,t,n){e.preventDefault();var o=q.textContent;j(!0,q,""),function(e,t,n,o,r,u,a,i){c(e,t,n).then((function(e){o.textContent=e.name,r.textContent=e.about,j(!1,a,i),L(u)})).catch((function(e){j(!1,a,i),console.log("Error: ".concat(e))}))}(t,n,{name:y.value,about:S.value},h,b,i,q,o)}(e,t,t.urls.userInfo)})),p.addEventListener("submit",(function(e){return function(e,t,n){e.preventDefault();var r=E.textContent;j(!0,E,""),function(e,t,n,r,c,u){(function(e,t,n){return fetch("".concat(e.urls.baseUrl).concat(t),{method:"POST",headers:e.headers.headers,body:JSON.stringify(n)}).then(o)})(e,t,n).then((function(t){D(B(t,e)),j(!1,c,u),L(r),r.querySelector(".popup__form").reset()})).catch((function(e){j(!1,c,u),console.log("Error: ".concat(e))}))}(t,n,{name:d.value,link:_.value},s,E,r)}(e,t,t.urls.cards)})),v.addEventListener("submit",(function(e){return function(e,t,n){e.preventDefault();var o=C.textContent;j(!0,C,""),function(e,t,n,o,r,u){c(e,t,n).then((function(e){P(e.avatar,w),j(!1,r,u),L(o),o.querySelector(".popup__form").reset()})).catch((function(e){j(!1,r,u),console.log("Error: ".concat(e))}))}(t,n,{avatar:m.value},l,C,o)}(e,t,t.urls.avatar)}))})();