(()=>{"use strict";function e(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))}var t={userId:"",urls:{baseUrl:"https://nomoreparties.co/v1/plus-cohort-5",cards:"/cards",likes:"/cards/likes",userInfo:"/users/me",avatar:"/users/me/avatar"},headers:{headers:{authorization:"0ebadb24-8922-4810-85ba-1c7bc357561a","Content-Type":"application/json"}}},n={formSelector:".popup__form",inputSelector:".popup__input",fieldsetSelector:".popup__input-container",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};function o(e,t){return fetch("".concat(e.urls.baseUrl).concat(t),e.headers).then((function(e){if(e.ok)return e.json();Promise.reject(e.status)}))}function r(e,t,n){return fetch("".concat(e.urls.baseUrl).concat(t),{method:"PATCH",headers:e.headers.headers,body:JSON.stringify(n)}).then((function(e){if(e.ok)return e.json();Promise.reject(e.status)}))}function c(e,t,n){return fetch("".concat(e.urls.baseUrl).concat(t,"/").concat(n),{method:"DELETE",headers:e.headers.headers}).then((function(e){if(e.ok)return e.json();Promise.reject(e.status)}))}var u=document.querySelectorAll(".popup"),a=document.querySelector(".popup_type_edit"),i=document.querySelector(".popup_type_add"),s=document.querySelector(".popup_type_confirm"),l=document.querySelector(".popup_type_avatar"),p=i.querySelector(".popup__form"),d=p.querySelector(".popup__input_type_title"),f=p.querySelector(".popup__input_type_link"),_=a.querySelector(".popup__form"),m=l.querySelector(".popup__form"),v=m.querySelector(".popup__input_type_avatar"),y=_.querySelector(".popup__input_type_name"),S=_.querySelector(".popup__input_type_caption"),h=document.querySelector(".profile__name"),b=document.querySelector(".profile__caption"),q=s.querySelector(".popup__save-button_type_confirm"),k=a.querySelector(".popup__save-button"),E=i.querySelector(".popup__save-button"),C=l.querySelector(".popup__save-button");function L(e){e.classList.add("popup_opened"),document.addEventListener("keydown",A)}function g(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",A)}function x(e,n){L(s),q.addEventListener("click",(function(){return function(e,t,n,o,r){c(e,t,n).then((function(){g(o),r.remove()})).catch((function(e){console.log("Error: ".concat(e))}))}(t,t.urls.cards,e,s,n)}))}function A(e){"Escape"===e.key&&g(document.querySelector(".popup_opened"))}var j=document.querySelector(".elements__list"),I=document.querySelector(".popup_type_image"),P=I.querySelector(".popup__image"),U=I.querySelector(".popup__title");function B(e,t){var n=document.querySelector("#content-card").content.querySelector(".content-card").cloneNode(!0),o=n.querySelector(".content-card__image"),r=n.querySelector(".content-card__delete-button"),u=n.querySelector(".content-card__like-button"),a=n.querySelector(".content-card__like-counter");n.querySelector(".content-card__title").textContent=e.name,a.textContent=e.likes.length,o.src=e.link,o.alt=e.name,o.addEventListener("click",(function(){P.src=e.link,P.alt=e.name,U.textContent=e.name,L(I)})),T(e,t)&&u.classList.add("content-card__like-button_active");var i=e;return u.addEventListener("click",(function(){T(i,t)?function(e,t){return c(e,e.urls.likes,t._id)}(t,e).then((function(e){i=e,a.textContent=e.likes.length,u.classList.remove("content-card__like-button_active")})):function(e,t){return function(e,t,n){return fetch("".concat(e.urls.baseUrl).concat(t,"/").concat(n),{method:"PUT",headers:e.headers.headers}).then((function(e){if(e.ok)return e.json();Promise.reject(e.status)}))}(e,e.urls.likes,t._id)}(t,e).then((function(e){i=e,a.textContent=e.likes.length,u.classList.add("content-card__like-button_active")}))})),e.owner._id!==t.userId?r.remove():r.addEventListener("click",(function(){return x(e._id,n)})),n}function D(e){j.prepend(e)}function T(e,t){return e.likes.some((function(e){return e._id===t.userId}))}var w=document.querySelector(".avatar");function N(e,t){t.style.backgroundImage="url(".concat(e,")")}function O(e,t,n){e?(t.textContent="Сохранение...",t.setAttribute("disabled",!0)):(t.textContent=n,t.removeAttribute("disabled"))}var J,z=document.querySelector(".page"),H=z.querySelector(".profile__edit-button"),M=z.querySelector(".profile__add-button"),F=z.querySelector(".avatar__edit"),G=document.forms.add,K=Array.from(G.querySelectorAll(n.inputSelector)),Q=G.querySelector(n.submitButtonSelector);!function(e,t,n,r){o(e,t).then((function(t){e.userId=t._id,n.textContent=t.name,r.textContent=t.about,N(t.avatar,w)})).catch((function(e){console.log("Error: ".concat(e))})).finally((function(){!function(e,t){o(e,t).then((function(t){t.reverse().forEach((function(t){D(B(t,e))}))})).catch((function(e){console.log("Error: ".concat(e))}))}(e,e.urls.cards)}))}(t,t.urls.userInfo,h,b),J=n,Array.from(document.querySelectorAll(J.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(J.fieldsetSelector)).forEach((function(t){!function(t,n){var o=Array.from(t.querySelectorAll(n.inputSelector)),r=t.querySelector(n.submitButtonSelector);e(o,r,n),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(t,c,n),e(o,r,n)}))}))}(t,J)}))})),u.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&g(e),t.target.classList.contains("popup__close-button")&&g(e)}))})),H.addEventListener("click",(function(){y.value=h.textContent,S.value=b.textContent,L(a)})),M.addEventListener("click",(function(){e(K,Q,n),L(i)})),F.addEventListener("click",(function(){e(K,Q,n),L(l)})),_.addEventListener("submit",(function(e){return function(e,t,n){e.preventDefault();var o=k.textContent;O(!0,k,""),function(e,t,n,o,c,u,a,i){r(e,t,n).then((function(e){o.textContent=e.name,c.textContent=e.about})).catch((function(e){console.log("Error: ".concat(e))})).finally((function(){O(!1,a,i),g(u)}))}(t,n,{name:y.value,about:S.value},h,b,a,k,o)}(e,t,t.urls.userInfo)})),p.addEventListener("submit",(function(e){return function(e,t,n){e.preventDefault();var o=E.textContent;O(!0,E,""),function(e,t,n,o,r,c){(function(e,t,n){return fetch("".concat(e.urls.baseUrl).concat(t),{method:"POST",headers:e.headers.headers,body:JSON.stringify(n)}).then((function(e){if(e.ok)return e.json();Promise.reject(e.status)}))})(e,t,n).then((function(t){D(B(t,e))})).catch((function(e){console.log("Error: ".concat(e))})).finally((function(){O(!1,r,c),g(o),o.querySelector(".popup__form").reset()}))}(t,n,{name:d.value,link:f.value},i,E,o)}(e,t,t.urls.cards)})),m.addEventListener("submit",(function(e){return function(e,t,n){e.preventDefault();var o=C.textContent;O(!0,C,""),function(e,t,n,o,c,u){r(e,t,n).then((function(e){N(e.avatar,w)})).catch((function(e){console.log("Error: ".concat(e))})).finally((function(){O(!1,c,u),g(o),o.querySelector(".popup__form").reset()}))}(t,n,{avatar:v.value},l,C,o)}(e,t,t.urls.avatar)}))})();